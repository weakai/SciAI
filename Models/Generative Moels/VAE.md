---
title: VAE
subtitle: Variational Autoencoders
---

术语 “变分” 源自统计中的正则化和变分推理方法。

直观地讲，整个自编码器结构（编码器+解码器）会构造出数据瓶颈（bottleneck），从而确保只有信息的主要部分可以通过瓶颈并进行重构。

单层等量 mlp 的编码器是线性的，等价于 PCA。对于线性自编码器，我们最终获得的新特征不必是独立的（神经网络中没有正交性约束）。

进一步假设编码器和解码器都是深度非线性网络的。在这种情况下，网络结构越复杂，自编码器就可以进行更多的降维，同时保持较低的重构损失。
实际上，具有“无限大能力”的编码器理论上可以将我们的 N 个初始数据编码为 1、2、3，…，最多 N 个（或更一般地说，为实轴上的 N 个整数），相关的解码器再进行逆变换，在这种过程中不会造成任何损失。

但是我们应该牢记两点。首先，在没有重建损失的情况下进行重要的降维通常会带来一个代价：隐空间中缺乏可解释和可利用的结构（**缺乏规则性，lack of regularity**）。其次，大多数时候，降维的最终目的不仅是减少数据的维数，而是要在减少维数的同时将数据主要的结构信息保留在简化的表示中。出于这两个原因，必须根据降维的最终目的来仔细控制和调整隐空间的大小和自编码器的“深度”（深度定义压缩的程度和质量）。

不规则的隐空间妨碍了我们用自编码器生成新数据。【图中展示了无限强自编码器的例子，虽然训练数据可以被无损失地压缩、重构，但在隐空间随机采样的点可能会解码出无意义的数据。

进入隐空间的编码数据之间缺乏结构是很正常的。的确，在自编码器的训练任务中，没有什么东西保证能够得到这种结构：**自编码器仅以尽可能少的损失为目标进行训练，而不管隐空间如何组织**。因此，如果我们对架构的定义不小心，那么在训练过程中，网络很自然地会利用任何过拟合的可能性来尽可能地完成其任务……除非我们明确对其进行规范化！

## 变分自编码器的定义

因此，为了能够将我们的自编码器的解码器用于生成目的，我们必须确保隐空间足够规则。获得这种规律性的一种可能方案是在训练过程中引入显式的正规化（regularisation）。**因此，正如我们在这篇文章的简介中提到的那样，变分自编码器可以定义为一种自编码器，其训练经过正规化以避免过度拟合，并确保隐空间具有能够进行数据生成过程的良好属性。**

就像标准自编码器一样，变分自编码器是一种由编码器和解码器组成的结构，经过训练以使编码解码后的数据与初始数据之间的重构误差最小。但是，为了引入隐空间的某些正则化，我们对编码-解码过程进行了一些修改：**我们不是将输入编码为隐空间中的单个点，而是将其编码为隐空间中的概率分布**。然后对模型进行如下训练：

首先，将输入编码为在隐空间上的分布；
第二，从该分布中采样隐空间中的一个点；
第三，对采样点进行解码并计算出重建误差；
最后，重建误差通过网络反向传播。

实践中，选择正态分布作为编码的分布，使得我们可以训练编码器来返回描述高斯分布的均值和协方差矩阵。

该正则化项为返回的分布与标准高斯之间的**Kulback-Leibler散度**

KL散度又称为相对熵，其定义为 $KL(p(x),q(x))=\sum p(x)log(\frac{p(x)}{q(x)})$。这个概念很重要，不只是 VAE，很多地方都会用到。

为了使生成过程成为可能，我们期望隐空间具有规则性，这可以通过两个主要属性表示：**连续性**（continuity，隐空间中的两个相邻点解码后不应呈现两个完全不同的内容）和**完整性**（completeness，针对给定的分布，从隐空间采样的点在解码后应提供“有意义”的内容）。

VAE 将输入编码为分布而不是点不足以确保连续性和完整性。如果没有明确定义的正则化项，则模型可以学习最小化其重构误差，从而“忽略”要返回一个分布，最终表现得几乎像普通自编码器一样（导致过度拟合）。具体地说，编码器可以返回具有微小方差的分布（往往是点分布，punctual distributions），或者返回具有巨大均值差异的分布（数据在隐空间中彼此相距很远）。在这两种情况下，返回分布的限制都没有取得效果，并且不满足连续性和/或完整性。

因此，为了避免这些影响，**我们必须同时对协方差矩阵和编码器返回的分布均值进行正则化**。实际上，通过强制分布接近标准正态分布（集中和简化）来完成此正则化。这样，我们要求协方差矩阵接近于单位阵，防止出现单点分布，并且均值接近于 0，防止编码分布彼此相距太远。

## VAE 的数学细节

在上一节中，我们给出了以下直观的概述：VAE 是将输入编码为分布而不是点的自编码器，并且其隐空间结构通过将编码器返回的分布约束为接近标准高斯而得以规范化。在本节中，我们将对 VAE 进行更数学的介绍，从而使我们可以更严格地证明正则化项的合理性。为此，我们将建立一个明确的概率框架，并将使用变分推理技术。

## 参考

[半小时理解变分自编码器 | 5](https://zhuanlan.zhihu.com/p/144649293)


